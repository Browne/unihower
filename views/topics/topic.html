{% extends '_default.html' %}

{% block main %}
<main class="container">
  <nav>
    <ol class="breadcrumb">
      <li><a href="/">Topics</a></li>
      <li class="active">{{ name }}</li>
    </ol>
  </nav>

  <div class="row">
    <div class="col-md-6">
      <div class="eisenhower-graph" data-topic-id="{{ id }}" data-graph-size="500"></div>
    </div>
    <div class="col-md-6">
      <h2>{{ name }}</h2>
      {% if description %}
      <h3>Description</h3>
      {{ description | markdown }}
      {% endif %}
      <div class="clearfix">
        <div class="btn-group pull-right">
          <a href="/topics/{{ id }}/update" class="btn btn-sm btn-primary">
            <i class="fa fa-pencil"></i> Edit Topic
          </a>

          <a href="#delete" class="btn btn-sm btn-danger" id="topicDeleteButton">
            <i class="fa fa-trash"></i> Delete Topic
          </a>
        </div>
      </div>

      <h3>Topic Tasks</h3>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>state</th>
            <th>description</th>
            <th>last updated</th>
          </tr>
        </thead>
        <tbody>
          {% for task in Tasks %}
          <tr rel="task-{{ task.id }}">
            <td><span class="label label-state-{{ task.state }}">{{ task.state }}</span></td>
            <td><a href="/tasks/{{ task.id }}">{{ task.description }}</a></td>
            <td>{{ task.updatedAt | calendar }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <a href="/tasks/create?topic={{ id }}" class="btn btn-default pull-right"><i class="fa fa-plus"></i> Create Task</a>
    </div>
  </div>
</main>
{% endblock %}

{% block custom_scripts %}
<script src="/assets/js/graph.js"></script>
<script>
  $(function() {
    $( '#topicDeleteButton' ).on( 'click', function() {
      if( window.confirm( 'Are you sure you want to delete this topic?' ) ) {
        $.ajax({
          type: 'DELETE',
          url: '/api/topics/{{ id }}',
          data: {
            _csrf: '{{ csrfToken }}'
          },
          dataType: 'json'
        }).done( function( data ) {
          window.location.href = "/topics";
        }).fail( function() {
          console.log( arguments );
        });
      }

      return false;
    });
  });
</script>
{% endblock %}
